<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Road Fighter Pro - Ø³Ù„Ù…Ø§Ù† Ø§Ù„Ø¬Ù†ÙŠØ¯ÙŠ</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@900&display=swap');
        body { margin: 0; background: #000; font-family: 'Cairo', sans-serif; overflow: hidden; display: flex; flex-direction: column; align-items: center; }
        #game-container { position: relative; width: 100vw; max-width: 450px; height: 85vh; border: 4px solid #333; overflow: hidden; background: #222; }
        canvas { width: 100%; height: 100%; image-rendering: pixelated; }
        #hud { position: absolute; top: 0; width: 100%; height: 50px; background: rgba(0,0,0,0.8); display: flex; justify-content: space-around; align-items: center; z-index: 50; border-bottom: 2px solid #f1c40f; color: #fff; }
        .overlay { position: absolute; inset: 0; background: rgba(0,0,0,0.9); display: flex; flex-direction: column; justify-content: center; align-items: center; z-index: 100; text-align: center; }
        .btn { background: #d32f2f; color: white; border: 3px solid #fff; padding: 12px 25px; margin: 10px; cursor: pointer; font-size: 1.2rem; font-weight: bold; border-radius: 10px; box-shadow: 0 4px 0 #5d0000; }
        #question-box { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 80%; background: #fff; color: #111; border: 5px solid #1e88e5; padding: 20px; z-index: 200; display: none; flex-direction: column; border-radius: 20px; }
        .ans-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 15px; }
        .ans-btn { background: #1e88e5; color: white; border: none; padding: 15px; font-size: 1.5rem; border-radius: 10px; font-weight: bold; }
        #controls { display: flex; width: 100%; max-width: 450px; height: 12vh; background: #111; justify-content: space-around; align-items: center; }
        .ctrl-btn { width: 65px; height: 65px; background: #333; border: 2px solid #555; border-radius: 50%; display: flex; justify-content: center; align-items: center; font-size: 1.8rem; user-select: none; color: white; }
        #gas-btn { background: #2e7d32; width: 85px; height: 85px; border: 3px solid #fff; font-size: 1rem; }
    </style>
</head>
<body>

<div id="game-container">
    <div id="hud">
        <div id="hud-fuel">Ø§Ù„ÙˆÙ‚ÙˆØ¯: Ù¡Ù Ù Ùª</div>
        <div id="hud-speed">Ø§Ù„Ø³Ø±Ø¹Ø©: Ù </div>
        <div id="hud-stage">Ø§Ù„Ù…Ø±Ø­Ù„Ø©: Ù¡</div>
    </div>
    <canvas id="gameCanvas"></canvas>

    <div id="start-screen" class="overlay">
        <h1 style="color:#f1c40f; font-size: 2.8rem; margin:0;">ROAD FIGHTER</h1>
        <p style="color:white">Ø¨Ø¥Ø´Ø±Ø§Ù Ø³Ù„Ù…Ø§Ù† Ø§Ù„Ø¬Ù†ÙŠØ¯ÙŠ</p>
        <button class="btn" onclick="game.start('easy')">Ù…Ø¨ØªØ¯Ø¦</button>
        <button class="btn" onclick="game.start('medium')">Ù…ØªÙˆØ³Ø·</button>
        <button class="btn" onclick="game.start('hard')">Ù…Ø­ØªØ±Ù</button>
        <div style="margin-top:15px; font-size: 0.8rem;">
            <a href="https://wa.me/966566996166" style="color:#4caf50; text-decoration:none;">ğŸ’¬ ÙˆØ§ØªØ³Ø§Ø¨</a> | 
            <a href="https://snapchat.com/t/2fysJJzn" style="color:#ffeb3b; text-decoration:none;">ğŸ‘» Ø³Ù†Ø§Ø¨</a>
        </div>
    </div>

    <div id="question-box">
        <h2 id="q-text" style="text-align:center; font-size: 2rem; margin:0;">Ø§Ù„Ø³Ø¤Ø§Ù„</h2>
        <div id="options" class="ans-grid"></div>
    </div>

    <div id="game-over" class="overlay" style="display:none">
        <h1 id="over-reason" style="color:#ff5252;">Ø§Ù†ØªÙ‡Øª Ø§Ù„Ù„Ø¹Ø¨Ø©</h1>
        <button class="btn" onclick="location.reload()">Ø¥Ø¹Ø§Ø¯Ø©</button>
    </div>
</div>

<div id="controls">
    <div class="ctrl-btn" id="l-btn">â—€</div>
    <div class="ctrl-btn" id="gas-btn">Ø¯Ø¹Ø³ â›½</div>
    <div class="ctrl-btn" id="r-btn">â–¶</div>
</div>

<script>
const toAr = (n) => n.toString().replace(/\d/g, d => "Ù Ù¡Ù¢Ù£Ù¤Ù¥Ù¦Ù§Ù¨Ù©"[d]);

const audio = {
    ctx: null, engineOsc: null, engineGain: null,
    init() {
        if(this.ctx) return;
        this.ctx = new (window.AudioContext || window.webkitAudioContext)();
        this.engineOsc = this.ctx.createOscillator();
        this.engineGain = this.ctx.createGain();
        this.engineOsc.type = 'triangle'; // ØµÙˆØª Ø£Ù†Ø¹Ù… ÙˆØ£ÙØ®Ù…
        this.engineOsc.frequency.setValueAtTime(40, this.ctx.currentTime);
        this.engineGain.gain.setValueAtTime(0, this.ctx.currentTime);
        this.engineOsc.connect(this.engineGain);
        this.engineGain.connect(this.ctx.destination);
        this.engineOsc.start();
    },
    updateEngine(speed) {
        if(!this.ctx) return;
        let v = speed > 0 ? 0.08 : 0;
        this.engineGain.gain.setTargetAtTime(v, this.ctx.currentTime, 0.1);
        this.engineOsc.frequency.setTargetAtTime(40 + speed * 12, this.ctx.currentTime, 0.1);
    },
    playEffect(freq, dur) {
        const o = this.ctx.createOscillator();
        const g = this.ctx.createGain();
        o.type = 'sine'; o.frequency.setValueAtTime(freq, this.ctx.currentTime);
        g.gain.setValueAtTime(0.1, this.ctx.currentTime);
        o.connect(g); g.connect(this.ctx.destination);
        o.start(); o.stop(this.ctx.currentTime + dur);
    }
};

const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
canvas.width = 400; canvas.height = 600;

const game = {
    active: false, speed: 0, fuel: 100, stage: 1, dist: 0,
    maxDist: 15000, // Ù…Ø±Ø­Ù„Ø© Ø·ÙˆÙŠÙ„Ø© Ø¬Ø¯Ø§Ù‹ ÙƒÙ…Ø§ Ø·Ù„Ø¨Øª
    playerX: 182, enemies: [], trees: [], roadY: 0, difficulty: 'easy',

    start(lvl) {
        audio.init();
        this.difficulty = lvl; this.active = true;
        document.getElementById('start-screen').style.display = 'none';
        for(let i=0; i<10; i++) this.trees.push({x: i%2===0?15:355, y: i*120});
        this.loop();
    },

    // Ø±Ø³Ù… Ø³ÙŠØ§Ø±Ø© Ø³Ø¨Ø§Ù‚ Ø­Ù‚ÙŠÙ‚ÙŠØ© (Ù„ÙŠØ³Øª Ø«Ù„Ø§Ø¬Ø©)
    drawCar(x, y, color, isPlayer) {
        ctx.save();
        ctx.translate(x, y);
        // Ø§Ù„Ø¬Ø³Ù… Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ Ø§Ù„Ù…Ù†Ø­Ù†ÙŠ
        ctx.fillStyle = color;
        ctx.beginPath();
        ctx.moveTo(4, 60); ctx.quadraticCurveTo(0, 30, 4, 5); // Ø§Ù„Ø¬Ø§Ù†Ø¨ Ø§Ù„Ø£ÙŠØ³Ø±
        ctx.lineTo(34, 5); ctx.quadraticCurveTo(38, 30, 34, 60); // Ø§Ù„Ø¬Ø§Ù†Ø¨ Ø§Ù„Ø£ÙŠÙ…Ù†
        ctx.closePath(); ctx.fill();
        // Ø§Ù„Ø¬Ù†Ø§Ø­ Ø§Ù„Ø®Ù„ÙÙŠ (Spoiler)
        ctx.fillStyle = '#111'; ctx.fillRect(-2, 52, 42, 6);
        // Ø§Ù„Ø²Ø¬Ø§Ø¬ Ø§Ù„Ø£Ù…Ø§Ù…ÙŠ Ø¨ØªØµÙ…ÙŠÙ… Ø±ÙŠØ§Ø¶ÙŠ
        ctx.fillStyle = '#1a1a1a';
        ctx.beginPath(); ctx.moveTo(7, 18); ctx.lineTo(31, 18); ctx.lineTo(27, 8); ctx.lineTo(11, 8); ctx.fill();
        // Ø¥Ø·Ø§Ø±Ø§Øª Ø¨Ø§Ø±Ø²Ø©
        ctx.fillStyle = '#000';
        ctx.fillRect(-4, 10, 6, 14); ctx.fillRect(36, 10, 6, 14);
        ctx.fillRect(-4, 40, 6, 14); ctx.fillRect(36, 40, 6, 14);
        // Ø£Ù†ÙˆØ§Ø±
        ctx.fillStyle = isPlayer ? '#fff' : '#ff4444';
        ctx.fillRect(6, 2, 8, 4); ctx.fillRect(24, 2, 8, 4);
        ctx.restore();
    },

    update() {
        if (!this.active) return;
        if (input.gas) {
            this.speed = Math.min(this.speed + 0.1, 9 + this.stage);
            this.fuel -= 0.02; // Ø§Ø³ØªÙ‡Ù„Ø§Ùƒ ÙˆÙ‚ÙˆØ¯ Ø£Ø¨Ø·Ø£ Ù„Ù„Ù…Ø±Ø§Ø­Ù„ Ø§Ù„Ø·ÙˆÙŠÙ„Ø©
            this.dist += this.speed;
        } else {
            this.speed = Math.max(this.speed - 0.12, 0);
        }
        audio.updateEngine(this.speed);

        if (this.fuel <= 0) this.end("Ø§Ù†ØªÙ‡Ù‰ Ø§Ù„ÙˆÙ‚ÙˆØ¯!");
        this.roadY += this.speed;

        if (input.left && this.playerX > 65) this.playerX -= 6;
        if (input.right && this.playerX < 300) this.playerX += 6;

        this.trees.forEach(t => {
            t.y += this.speed;
            if (t.y > canvas.height) t.y = -100;
        });

        if (this.speed > 0 && this.enemies.length < 3 && Math.random() < 0.02) {
            let lx = [80, 150, 220, 290][Math.floor(Math.random()*4)];
            if(!this.enemies.some(e => e.y < 250)) this.enemies.push({x: lx, y: -100, s: 1+Math.random()});
        }

        this.enemies.forEach((en, i) => {
            en.y += (this.speed * 0.6) + en.s; 
            if (Math.abs(this.playerX - en.x) < 35 && Math.abs(500 - en.y) < 60) this.ask();
            if (en.y > canvas.height) this.enemies.splice(i, 1);
        });

        if (this.dist >= this.maxDist) this.nextStage();

        document.getElementById('hud-fuel').innerText = `Ø§Ù„ÙˆÙ‚ÙˆØ¯: ${toAr(Math.ceil(this.fuel))}Ùª`;
        document.getElementById('hud-speed').innerText = `Ø§Ù„Ø³Ø±Ø¹Ø©: ${toAr(Math.floor(this.speed * 35))}`;
        document.getElementById('hud-stage').innerText = `Ø§Ù„Ù…Ø±Ø­Ù„Ø©: ${toAr(this.stage)}`;
    },

    draw() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        // Ø§Ù„Ø¹Ø´Ø¨ ÙˆØ§Ù„Ø´Ø§Ø±Ø¹
        ctx.fillStyle = '#1b5e20'; ctx.fillRect(0,0, canvas.width, canvas.height);
        ctx.fillStyle = '#333'; ctx.fillRect(60, 0, 280, canvas.height);
        
        // Ø§Ù„Ø£Ø±ØµÙØ© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ© Ø§Ù„Ù…Ù…ÙŠØ²Ø©
        for(let i=-1; i<16; i++) {
            let y = (i*40) + (this.roadY % 40);
            ctx.fillStyle = (Math.floor(this.roadY/40)+i)%2===0 ? '#fff' : '#d32f2f';
            ctx.fillRect(60, y, 10, 40); ctx.fillRect(330, y, 10, 40);
        }

        // Ø®Ø·ÙˆØ· Ø§Ù„Ø·Ø±ÙŠÙ‚
        ctx.strokeStyle = 'rgba(255,255,255,0.3)'; ctx.setLineDash([20, 40]);
        ctx.lineDashOffset = -this.roadY;
        [130, 200, 270].forEach(lx => { ctx.beginPath(); ctx.moveTo(lx, 0); ctx.lineTo(lx, canvas.height); ctx.stroke(); });

        // Ø§Ù„Ø£Ø´Ø¬Ø§Ø±
        this.trees.forEach(t => {
            ctx.fillStyle = '#2e7d32'; ctx.beginPath();
            ctx.moveTo(t.x, t.y+40); ctx.lineTo(t.x+15, t.y); ctx.lineTo(t.x+30, t.y+40); ctx.fill();
        });

        // Ø®Ø· Ø§Ù„Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø«Ø§Ø¨Øª
        let finishLineY = 500 - (this.maxDist - this.dist);
        if (this.maxDist - this.dist < 1200) {
            ctx.fillStyle = '#fff';
            for(let i=0; i<7; i++) {
                ctx.fillRect(70 + i*40, finishLineY, 20, 20);
                ctx.fillRect(90 + i*40, finishLineY + 20, 20, 20);
            }
        }

        this.drawCar(this.playerX, 500, '#e53935', true);
        this.enemies.forEach(en => this.drawCar(en.x, en.y, '#fdd835', false));
    },

    ask() {
        this.active = false; audio.playEffect(200, 0.3);
        const qData = this.genQ();
        document.getElementById('question-box').style.display = 'flex';
        document.getElementById('q-text').innerText = qData.txt;
        const optsDiv = document.getElementById('options');
        optsDiv.innerHTML = '';
        qData.opts.forEach(o => {
            const b = document.createElement('button');
            b.className = 'ans-btn'; b.innerText = toAr(o);
            b.onclick = () => {
                if (o === qData.ans) {
                    audio.playEffect(600, 0.2);
                    document.getElementById('question-box').style.display = 'none';
                    this.fuel = 100; this.enemies = []; this.active = true; this.loop();
                } else { this.end("Ø¥Ø¬Ø§Ø¨Ø© Ø®Ø§Ø·Ø¦Ø©!"); }
            };
            optsDiv.appendChild(b);
        });
    },

    genQ() {
        let a = Math.floor(Math.random()*12), b = Math.floor(Math.random()*12), ans, txt;
        if(this.difficulty === 'easy') { txt = `${toAr(a)} ï¼‹ ${toAr(b)}`; ans = a+b; }
        else if(this.difficulty === 'medium') { txt = `${toAr(a)} Ã— ${toAr(b)}`; ans = a*b; }
        else { ans = Math.floor(Math.random()*10); b = Math.floor(Math.random()*9)+1; a = ans*b; txt = `${toAr(a)} Ã· ${toAr(b)}`; }
        let opts = [ans, ans+1, ans+10, ans-2].filter(n=>n>=0).sort(()=>Math.random()-0.5);
        return { txt, ans, opts: [...new Set(opts)].slice(0,4) };
    },

    nextStage() {
        this.active = false; audio.playEffect(800, 0.5);
        setTimeout(() => {
            alert(`ÙƒÙÙˆ! Ø£ØªÙ…Ù…Øª Ø§Ù„Ù…Ø±Ø­Ù„Ø© ${toAr(this.stage)} Ø¨Ù†Ø¬Ø§Ø­`);
            this.stage++; this.dist = 0; this.fuel = 100; this.enemies = []; this.active = true; this.loop();
        }, 100);
    },

    end(msg) {
        this.active = false; audio.updateEngine(0);
        document.getElementById('question-box').style.display = 'none';
        document.getElementById('over-reason').innerText = msg;
        document.getElementById('game-over').style.display = 'flex';
    },

    loop() { if(this.active) { this.update(); this.draw(); requestAnimationFrame(() => this.loop()); } }
};

const input = { left: false, right: false, gas: false };
const setup = (id, key) => {
    const el = document.getElementById(id);
    el.onpointerdown = (e) => { e.preventDefault(); audio.init(); input[key] = true; };
    el.onpointerup = (e) => { e.preventDefault(); input[key] = false; };
};
setup('l-btn', 'left'); setup('r-btn', 'right'); setup('gas-btn', 'gas');
window.onkeydown = (e) => { audio.init(); if(e.key.includes('Left')) input.left = true; if(e.key.includes('Right')) input.right = true; if(e.key===' '||e.key.includes('Up')) input.gas = true; };
window.onkeyup = (e) => { if(e.key.includes('Left')) input.left = false; if(e.key.includes('Right')) input.right = false; if(e.key===' '||e.key.includes('Up')) input.gas = false; };
</script>
</body>
</html>
