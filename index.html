<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Road Fighter Math - Ø³Ù„Ù…Ø§Ù† Ø§Ù„Ø¬Ù†ÙŠØ¯ÙŠ</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@900&display=swap');
        
        body {
            margin: 0; background: #000; font-family: 'Cairo', sans-serif;
            color: white; overflow: hidden; display: flex; flex-direction: column; align-items: center;
        }

        #game-wrapper {
            position: relative; width: 100vw; max-width: 420px; height: 85vh;
            border: 4px solid #333; overflow: hidden;
        }

        canvas { width: 100%; height: 100%; image-rendering: pixelated; }

        #hud {
            position: absolute; top: 0; left: 0; width: 100%; height: 50px;
            background: rgba(0,0,0,0.8); display: flex; justify-content: space-around;
            align-items: center; z-index: 50; border-bottom: 2px solid #f1c40f;
        }

        .overlay {
            position: absolute; inset: 0; background: rgba(0,0,0,0.9);
            display: flex; flex-direction: column; justify-content: center; align-items: center; z-index: 100;
        }

        .btn {
            background: #d32f2f; color: white; border: 3px solid #fff; padding: 12px 25px;
            margin: 8px; cursor: pointer; font-size: 1.2rem; font-weight: bold; border-radius: 10px;
        }

        #question-box {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            width: 85%; background: #fff; color: #222; border: 5px solid #d32f2f;
            padding: 20px; z-index: 200; display: none; flex-direction: column; border-radius: 20px;
        }

        .ans-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 15px; }
        .ans-btn { background: #1976d2; color: white; border: none; padding: 15px; font-size: 1.4rem; border-radius: 10px; }

        .footer-info { margin-top: 10px; font-size: 0.9rem; text-align: center; }
        .social-btns { display: flex; gap: 20px; margin-top: 10px; }
        .social-btns a { text-decoration: none; font-size: 1.5rem; }

        #controls {
            display: flex; width: 100%; max-width: 420px; height: 12vh;
            background: #111; justify-content: space-around; align-items: center;
        }
        .ctrl-btn { width: 65px; height: 65px; background: #333; border-radius: 50%; display: flex; justify-content: center; align-items: center; font-size: 1.5rem; user-select: none; }
        #gas-btn { background: #2e7d32; width: 80px; border: 3px solid #fff; }
    </style>
</head>
<body>

<div id="game-wrapper">
    <div id="hud">
        <div id="hud-fuel">Ø§Ù„ÙˆÙ‚ÙˆØ¯: Ù¡Ù Ù Ùª</div>
        <div id="hud-speed">Ø§Ù„Ø³Ø±Ø¹Ø©: Ù </div>
        <div id="hud-stage">Ø§Ù„Ù…Ø±Ø­Ù„Ø©: Ù¡</div>
    </div>

    <canvas id="gameCanvas"></canvas>

    <div id="start-screen" class="overlay">
        <h1 style="color:#f1c40f; font-size: 2.5rem; margin:0;">ROAD FIGHTER</h1>
        <p>Ø¨Ø¥Ø´Ø±Ø§Ù Ø³Ù„Ù…Ø§Ù† Ø§Ù„Ø¬Ù†ÙŠØ¯ÙŠ</p>
        <button class="btn" onclick="game.start('easy')">Ù…Ø¨ØªØ¯Ø¦</button>
        <button class="btn" onclick="game.start('medium')">Ù…ØªÙˆØ³Ø·</button>
        <button class="btn" onclick="game.start('hard')">Ù…Ø­ØªØ±Ù</button>
        
        <div class="footer-info">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø© Ù„Ù€ Ø³Ù„Ù…Ø§Ù† Ø§Ù„Ø¬Ù†ÙŠØ¯ÙŠ</div>
        <div class="social-btns">
            <a href="https://wa.me/966566996166">ğŸŸ¢</a>
            <a href="https://snapchat.com/t/2fysJJzn">ğŸŸ¡</a>
        </div>
    </div>

    <div id="question-box">
        <h2 id="q-text" style="text-align:center; font-size: 2rem;">Ø§Ù„Ø³Ø¤Ø§Ù„</h2>
        <div id="options" class="ans-grid"></div>
    </div>

    <div id="game-over" class="overlay" style="display:none">
        <h1 id="over-reason" style="color:red;">Ø§Ù†ØªÙ‡Øª Ø§Ù„Ù„Ø¹Ø¨Ø©</h1>
        <button class="btn" onclick="location.reload()">Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰</button>
    </div>
</div>

<div id="controls">
    <div class="ctrl-btn" id="l-btn">â—€</div>
    <div class="ctrl-btn" id="gas-btn">GAS</div>
    <div class="ctrl-btn" id="r-btn">â–¶</div>
</div>

<script>
const toAr = (n) => n.toString().replace(/\d/g, d => "Ù Ù¡Ù¢Ù£Ù¤Ù¥Ù¦Ù§Ù¨Ù©"[d]);

// Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„ØµÙˆØªÙŠ
const audio = {
    ctx: null,
    init() { if(!this.ctx) this.ctx = new (window.AudioContext || window.webkitAudioContext)(); },
    play(freq, type, dur) {
        this.init();
        const osc = this.ctx.createOscillator();
        const gain = this.ctx.createGain();
        osc.type = type;
        osc.frequency.setValueAtTime(freq, this.ctx.currentTime);
        gain.gain.setValueAtTime(0.1, this.ctx.currentTime);
        osc.connect(gain); gain.connect(this.ctx.destination);
        osc.start(); osc.stop(this.ctx.currentTime + dur);
    }
};

const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
canvas.width = 400; canvas.height = 600;

const game = {
    active: false, speed: 0, fuel: 100, stage: 1, dist: 0,
    playerX: 182, enemies: [], roadY: 0, difficulty: 'easy',
    colors: [
        { grass: '#2e7d32', road: '#444' }, // ØºØ§Ø¨Ø©
        { grass: '#c6a700', road: '#555' }, // ØµØ­Ø±Ø§Ø¡
        { grass: '#1a237e', road: '#222' }  // Ù„ÙŠÙ„
    ],

    start(lvl) {
        this.difficulty = lvl; this.active = true;
        document.getElementById('start-screen').style.display = 'none';
        this.loop();
    },

    drawCar(x, y, color, isPlayer) {
        ctx.fillStyle = color; ctx.fillRect(x, y, 36, 60); // Ø§Ù„Ø¬Ø³Ù…
        ctx.fillStyle = '#000'; ctx.fillRect(x+4, y+10, 28, 12); // Ø²Ø¬Ø§Ø¬
        ctx.fillStyle = isPlayer ? '#fff' : '#f44336'; 
        ctx.fillRect(x+5, y, 6, 3); ctx.fillRect(x+25, y, 6, 3); // Ù…ØµØ§Ø¨ÙŠØ­
    },

    update() {
        if (!this.active) return;

        if (input.gas) {
            this.speed = Math.min(this.speed + 0.1, 8 + this.stage);
            this.fuel -= 0.04;
            this.dist += this.speed;
            if(Math.random() > 0.9) audio.play(100 + this.speed*10, 'sawtooth', 0.05);
        } else {
            this.speed = Math.max(this.speed - 0.15, 0);
        }

        if (this.fuel <= 0) this.end("Ø§Ù†ØªÙ‡Ù‰ Ø§Ù„ÙˆÙ‚ÙˆØ¯!");
        
        // Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ù„Ù„Ù…Ø±Ø­Ù„Ø©
        if (this.dist > 3000) {
            this.speed = 0; this.active = false;
            audio.play(500, 'square', 0.5);
            setTimeout(() => { 
                this.stage++; this.dist = 0; this.fuel = 100; 
                this.enemies = []; this.active = true; this.loop();
            }, 2000);
            return;
        }

        this.roadY += this.speed;
        if (input.left && this.playerX > 60) this.playerX -= 5;
        if (input.right && this.playerX < 304) this.playerX += 5;

        // Ø§Ù„Ø£Ø¹Ø¯Ø§Ø¡ ÙŠØªØ­Ø±ÙƒÙˆÙ† Ø¨Ø§Ù„Ù†Ø³Ø¨Ø© Ù„Ø³Ø±Ø¹ØªÙƒ (Ù„Ø§ ÙŠØ±Ø¬Ø¹ÙˆÙ† Ù„Ù„Ø®Ù„Ù)
        if (this.speed > 0 && Math.random() < 0.02) {
            this.enemies.push({x: [80,150,220,290][Math.floor(Math.random()*4)], y: -100});
        }

        this.enemies.forEach((en, i) => {
            // Ø³Ø±Ø¹Ø© Ø§Ù„Ø¹Ø¯Ùˆ = (Ø³Ø±Ø¹ØªÙƒ * 0.5) + Ø³Ø±Ø¹Ø© Ø«Ø§Ø¨ØªØ© Ø¨Ø³ÙŠØ·Ø© Ù„Ù„Ø§Ù…Ø§Ù…
            en.y += (this.speed * 0.5) + 1; 
            if (this.playerX < en.x + 36 && this.playerX + 36 > en.x && 500 < en.y + 60 && 560 > en.y) {
                this.ask();
            }
            if (en.y > canvas.height) this.enemies.splice(i, 1);
        });

        document.getElementById('hud-fuel').innerText = `Ø§Ù„ÙˆÙ‚ÙˆØ¯: ${toAr(Math.ceil(this.fuel))}Ùª`;
        document.getElementById('hud-speed').innerText = `Ø§Ù„Ø³Ø±Ø¹Ø©: ${toAr(Math.floor(this.speed * 30))}`;
        document.getElementById('hud-stage').innerText = `Ø§Ù„Ù…Ø±Ø­Ù„Ø©: ${toAr(this.stage)}`;
    },

    draw() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        const theme = this.colors[(this.stage - 1) % 3];
        
        ctx.fillStyle = theme.grass; ctx.fillRect(0,0, canvas.width, canvas.height);
        ctx.fillStyle = theme.road; ctx.fillRect(50, 0, 300, canvas.height);
        
        // Ø®Ø·ÙˆØ· Ø§Ù„Ø·Ø±ÙŠÙ‚
        ctx.strokeStyle = '#fff'; ctx.setLineDash([30, 30]);
        ctx.lineDashOffset = -this.roadY;
        [125, 200, 275].forEach(lx => {
            ctx.beginPath(); ctx.moveTo(lx, 0); ctx.lineTo(lx, canvas.height); ctx.stroke();
        });

        // Ø®Ø· Ø§Ù„Ù†Ù‡Ø§ÙŠØ©
        if (this.dist > 2500) {
            let lineY = 500 - (this.dist - 2500);
            ctx.fillStyle = '#fff';
            for(let i=0; i<8; i++) ctx.fillRect(50 + i*40, lineY, 20, 20);
        }

        this.drawCar(this.playerX, 500, '#e53935', true);
        this.enemies.forEach(en => this.drawCar(en.x, en.y, '#fdd835', false));
    },

    ask() {
        this.active = false; audio.play(200, 'square', 0.2);
        const qData = this.genQ();
        document.getElementById('question-box').style.display = 'flex';
        document.getElementById('q-text').innerText = qData.txt;
        const optsDiv = document.getElementById('options');
        optsDiv.innerHTML = '';
        
        qData.opts.forEach(o => {
            const b = document.createElement('button');
            b.className = 'ans-btn'; b.innerText = toAr(o);
            b.onclick = () => {
                if (o === qData.ans) {
                    audio.play(800, 'sine', 0.2);
                    document.getElementById('question-box').style.display = 'none';
                    this.fuel = 100; this.enemies = []; this.active = true; this.loop();
                } else { this.end("Ø¥Ø¬Ø§Ø¨Ø© Ø®Ø§Ø·Ø¦Ø©!"); }
            };
            optsDiv.appendChild(b);
        });
    },

    genQ() {
        let a, b, ans, txt;
        if (this.difficulty === 'easy') {
            a = Math.floor(Math.random()*11); b = Math.floor(Math.random()*11);
            if (Math.random()>0.5) { txt = `${toAr(a)} ï¼‹ ${toAr(b)}`; ans = a+b; }
            else { txt = `${toAr(Math.max(a,b))} ï¼ ${toAr(Math.min(a,b))}`; ans = Math.max(a,b)-Math.min(a,b); }
        } else if (this.difficulty === 'medium') {
            a = Math.floor(Math.random()*11); b = Math.floor(Math.random()*11);
            txt = `${toAr(a)} Ã— ${toAr(b)}`; ans = a*b;
        } else {
            ans = Math.floor(Math.random()*10); b = Math.floor(Math.random()*9)+1;
            a = ans * b; txt = `${toAr(a)} Ã· ${toAr(b)}`;
        }
        let opts = [ans, ans+1, ans+5, ans-1].filter(n => n >= 0).sort(() => Math.random()-0.5);
        return { txt, ans, opts: [...new Set(opts)].slice(0,4) };
    },

    end(msg) {
        this.active = false;
        document.getElementById('question-box').style.display = 'none';
        document.getElementById('over-reason').innerText = msg;
        document.getElementById('game-over').style.display = 'flex';
    },

    loop() {
        if (!this.active) return;
        this.update(); this.draw();
        requestAnimationFrame(() => this.loop());
    }
};

const input = { left: false, right: false, gas: false };
window.onkeydown = (e) => {
    if (e.key === 'ArrowLeft') input.left = true;
    if (e.key === 'ArrowRight') input.right = true;
    if (e.key === 'ArrowUp' || e.key === ' ') { audio.init(); input.gas = true; }
};
window.onkeyup = (e) => {
    if (e.key === 'ArrowLeft') input.left = false;
    if (e.key === 'ArrowRight') input.right = false;
    if (e.key === 'ArrowUp' || e.key === ' ') input.gas = false;
};
const setupBtn = (id, key) => {
    const el = document.getElementById(id);
    el.onpointerdown = (e) => { e.preventDefault(); audio.init(); input[key] = true; };
    el.onpointerup = (e) => { e.preventDefault(); input[key] = false; };
};
setupBtn('l-btn', 'left'); setupBtn('r-btn', 'right'); setupBtn('gas-btn', 'gas');
</script>
</body>
</html>
