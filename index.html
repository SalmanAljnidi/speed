<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Road Fighter Math - Ø³Ù„Ù…Ø§Ù† Ø§Ù„Ø¬Ù†ÙŠØ¯ÙŠ</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@900&display=swap');
        body { margin: 0; background: #111; font-family: 'Cairo', sans-serif; color: white; overflow: hidden; display: flex; flex-direction: column; align-items: center; }
        #game-container { position: relative; width: 100vw; max-width: 450px; height: 82vh; border: 5px solid #444; background: #333; overflow: hidden; }
        canvas { width: 100%; height: 100%; image-rendering: pixelated; }
        #hud { position: absolute; top: 0; left: 0; width: 100%; height: 55px; background: rgba(0,0,0,0.85); display: flex; justify-content: space-around; align-items: center; z-index: 50; border-bottom: 3px solid #f1c40f; }
        .overlay { position: absolute; inset: 0; background: rgba(0,0,0,0.95); display: flex; flex-direction: column; justify-content: center; align-items: center; z-index: 100; text-align: center; }
        .btn { background: #d32f2f; color: white; border: 3px solid #fff; padding: 15px 30px; margin: 10px; cursor: pointer; font-size: 1.3rem; font-weight: bold; border-radius: 12px; box-shadow: 0 5px 0 #5d0000; }
        #question-box { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 85%; background: #fff; color: #111; border: 6px solid #1e88e5; padding: 25px; z-index: 200; display: none; flex-direction: column; border-radius: 25px; }
        .ans-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 20px; }
        .ans-btn { background: #1e88e5; color: white; border: none; padding: 18px; font-size: 1.6rem; border-radius: 12px; font-weight: 900; }
        #controls { display: flex; width: 100%; max-width: 450px; height: 13vh; background: #111; justify-content: space-around; align-items: center; }
        .ctrl-btn { width: 75px; height: 75px; background: #333; border: 2px solid #666; border-radius: 50%; display: flex; justify-content: center; align-items: center; font-size: 2rem; user-select: none; }
        #gas-btn { background: #2e7d32; width: 95px; height: 95px; border: 4px solid #fff; font-size: 1.1rem; }
    </style>
</head>
<body>

<div id="game-container">
    <div id="hud">
        <div id="hud-fuel">Ø§Ù„ÙˆÙ‚ÙˆØ¯: Ù¡Ù Ù Ùª</div>
        <div id="hud-speed">Ø§Ù„Ø³Ø±Ø¹Ø©: Ù </div>
        <div id="hud-stage">Ø§Ù„Ù…Ø±Ø­Ù„Ø©: Ù¡</div>
    </div>
    <canvas id="gameCanvas"></canvas>

    <div id="start-screen" class="overlay">
        <h1 style="color: #ff3d00; font-size: 3rem;">ROAD FIGHTER</h1>
        <p>Ø¨Ø¥Ø´Ø±Ø§Ù Ø³Ù„Ù…Ø§Ù† Ø§Ù„Ø¬Ù†ÙŠØ¯ÙŠ</p>
        <button class="btn" onclick="game.start('easy')">Ù…Ø¨ØªØ¯Ø¦</button>
        <button class="btn" onclick="game.start('medium')">Ù…ØªÙˆØ³Ø·</button>
        <button class="btn" onclick="game.start('hard')">Ù…Ø­ØªØ±Ù</button>
        <div style="margin-top:20px;">
            <a href="https://wa.me/966566996166" style="text-decoration:none;">ğŸŸ¢ ÙˆØ§ØªØ³Ø§Ø¨</a> | 
            <a href="https://snapchat.com/t/2fysJJzn" style="text-decoration:none;">ğŸŸ¡ Ø³Ù†Ø§Ø¨</a>
        </div>
    </div>

    <div id="question-box">
        <h2 id="q-text" style="text-align:center; font-size: 2.2rem; margin:0;">Ø§Ù„Ø³Ø¤Ø§Ù„</h2>
        <div id="options" class="ans-grid"></div>
    </div>

    <div id="game-over" class="overlay" style="display:none">
        <h1 id="over-reason" style="color:#ff5252;">Ø§Ù†ØªÙ‡Øª Ø§Ù„Ù„Ø¹Ø¨Ø©</h1>
        <button class="btn" onclick="location.reload()">Ø¥Ø¹Ø§Ø¯Ø©</button>
    </div>
</div>

<div id="controls">
    <div class="ctrl-btn" id="l-btn">â—€</div>
    <div class="ctrl-btn" id="gas-btn">Ø§Ø¯Ø¹Ø³ â›½</div>
    <div class="ctrl-btn" id="r-btn">â–¶</div>
</div>

<script>
const toAr = (n) => n.toString().replace(/\d/g, d => "Ù Ù¡Ù¢Ù£Ù¤Ù¥Ù¦Ù§Ù¨Ù©"[d]);

const audio = {
    ctx: null, engineOsc: null, engineGain: null,
    init() {
        if(this.ctx) return;
        this.ctx = new (window.AudioContext || window.webkitAudioContext)();
        this.engineOsc = this.ctx.createOscillator();
        this.engineGain = this.ctx.createGain();
        this.engineOsc.type = 'sawtooth';
        this.engineOsc.frequency.setValueAtTime(50, this.ctx.currentTime);
        this.engineGain.gain.setValueAtTime(0, this.ctx.currentTime);
        this.engineOsc.connect(this.engineGain);
        this.engineGain.connect(this.ctx.destination);
        this.engineOsc.start();
    },
    updateEngine(speed) {
        if(!this.ctx) return;
        this.engineGain.gain.setTargetAtTime(speed > 0 ? 0.05 : 0, this.ctx.currentTime, 0.1);
        this.engineOsc.frequency.setTargetAtTime(50 + speed * 15, this.ctx.currentTime, 0.1);
    },
    playEffect(freq, type, dur, vol=0.1) {
        const osc = this.ctx.createOscillator();
        const g = this.ctx.createGain();
        osc.type = type; osc.frequency.setValueAtTime(freq, this.ctx.currentTime);
        g.gain.setValueAtTime(vol, this.ctx.currentTime);
        osc.connect(g); g.connect(this.ctx.destination);
        osc.start(); osc.stop(this.ctx.currentTime + dur);
    }
};

const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
canvas.width = 400; canvas.height = 600;

const game = {
    active: false, speed: 0, fuel: 100, stage: 1, dist: 0,
    maxDist: 8000, // Ù…Ø³Ø§ÙØ© Ø§Ù„Ù…Ø±Ø­Ù„Ø© (Ø·ÙˆÙŠÙ„Ø©)
    playerX: 182, enemies: [], trees: [], roadY: 0, difficulty: 'easy',

    start(lvl) {
        audio.init();
        this.difficulty = lvl; this.active = true;
        document.getElementById('start-screen').style.display = 'none';
        for(let i=0; i<8; i++) this.trees.push({x: i%2===0?15:355, y: i*150});
        this.loop();
    },

    drawCar(x, y, color, isPlayer) {
        ctx.fillStyle = color; ctx.beginPath(); ctx.roundRect(x, y, 38, 65, 8); ctx.fill();
        ctx.fillStyle = '#222'; ctx.fillRect(x+5, y+12, 28, 15); // Ø²Ø¬Ø§Ø¬
        ctx.fillStyle = isPlayer ? '#fff' : '#ff5252'; 
        ctx.fillRect(x+5, y+2, 8, 4); ctx.fillRect(x+25, y+2, 8, 4); // Ù„Ù…Ø¨Ø§Øª
    },

    update() {
        if (!this.active) return;

        if (input.gas) {
            this.speed = Math.min(this.speed + 0.12, 9 + this.stage);
            this.fuel -= 0.03;
            this.dist += this.speed;
        } else {
            this.speed = Math.max(this.speed - 0.1, 0);
        }
        audio.updateEngine(this.speed);

        if (this.fuel <= 0) this.end("Ù†ÙØ¯ Ø§Ù„ÙˆÙ‚ÙˆØ¯!");

        this.roadY += this.speed;
        if (input.left && this.playerX > 65) this.playerX -= 6;
        if (input.right && this.playerX < 300) this.playerX += 6;

        this.trees.forEach(t => {
            t.y += this.speed;
            if (t.y > canvas.height) t.y = -100;
        });

        if (this.speed > 0 && this.enemies.length < 3 && Math.random() < 0.03) {
            let lx = [80, 150, 220, 290][Math.floor(Math.random()*4)];
            if(!this.enemies.some(e => e.y < 200)) this.enemies.push({x: lx, y: -100, s: 1+Math.random()});
        }

        this.enemies.forEach((en, i) => {
            en.y += (this.speed * 0.6) + en.s; 
            if (Math.abs(this.playerX - en.x) < 35 && Math.abs(500 - en.y) < 60) this.ask();
            if (en.y > canvas.height) this.enemies.splice(i, 1);
        });

        // ÙØ­Øµ Ø®Ø· Ø§Ù„Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø«Ø§Ø¨Øª
        if (this.dist >= this.maxDist && this.active) this.nextStage();

        document.getElementById('hud-fuel').innerText = `Ø§Ù„ÙˆÙ‚ÙˆØ¯: ${toAr(Math.ceil(this.fuel))}Ùª`;
        document.getElementById('hud-speed').innerText = `Ø§Ù„Ø³Ø±Ø¹Ø©: ${toAr(Math.floor(this.speed * 35))}`;
        document.getElementById('hud-stage').innerText = `Ø§Ù„Ù…Ø±Ø­Ù„Ø©: ${toAr(this.stage)}`;
    },

    draw() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        ctx.fillStyle = '#2e7d32'; ctx.fillRect(0,0, canvas.width, canvas.height);
        ctx.fillStyle = '#444'; ctx.fillRect(60, 0, 280, canvas.height);
        
        // Ø§Ù„Ø£Ø±ØµÙØ©
        for(let i=-1; i<16; i++) {
            let y = (i*40) + (this.roadY % 40);
            ctx.fillStyle = (Math.floor(this.roadY/40)+i)%2===0 ? '#fff' : '#d32f2f';
            ctx.fillRect(60, y, 8, 40); ctx.fillRect(332, y, 8, 40);
        }

        // Ø®Ø·ÙˆØ· Ø§Ù„Ù…Ø³Ø§Ø±Ø§Øª
        ctx.strokeStyle = 'rgba(255,255,255,0.4)'; ctx.setLineDash([20, 30]);
        ctx.lineDashOffset = -this.roadY;
        [130, 200, 270].forEach(lx => { ctx.beginPath(); ctx.moveTo(lx, 0); ctx.lineTo(lx, canvas.height); ctx.stroke(); });

        this.trees.forEach(t => {
            ctx.fillStyle = '#1b5e20'; ctx.beginPath(); ctx.moveTo(t.x, t.y+40); ctx.lineTo(t.x+15, t.y); ctx.lineTo(t.x+30, t.y+40); ctx.fill();
        });

        // Ø±Ø³Ù… Ø®Ø· Ø§Ù„Ù†Ù‡Ø§ÙŠØ© Ø¨Ø­ÙŠØ« Ø§Ù„Ø³ÙŠØ§Ø±Ø© Ù‡ÙŠ Ø§Ù„Ù„ÙŠ ØªÙˆØµÙ„Ù‡
        let finishLinePos = this.maxDist - this.dist;
        if (finishLinePos < 1000) {
            let lineY = 500 - finishLinePos;
            ctx.fillStyle = '#fff';
            for(let i=0; i<7; i++) ctx.fillRect(68 + i*40, lineY, 20, 20);
            for(let i=0; i<7; i++) ctx.fillRect(88 + i*40, lineY + 20, 20, 20);
        }

        this.drawCar(this.playerX, 500, '#d32f2f', true);
        this.enemies.forEach(en => this.drawCar(en.x, en.y, '#ffc107', false));
    },

    ask() {
        this.active = false; audio.playEffect(150, 'square', 0.4);
        const qData = this.genQ();
        document.getElementById('question-box').style.display = 'flex';
        document.getElementById('q-text').innerText = qData.txt;
        const optsDiv = document.getElementById('options');
        optsDiv.innerHTML = '';
        qData.opts.forEach(o => {
            const b = document.createElement('button');
            b.className = 'ans-btn'; b.innerText = toAr(o);
            b.onclick = () => {
                if (o === qData.ans) {
                    audio.playEffect(800, 'sine', 0.2);
                    document.getElementById('question-box').style.display = 'none';
                    this.fuel = 100; this.enemies = []; this.active = true; this.loop();
                } else { this.end("Ø¥Ø¬Ø§Ø¨Ø© Ø®Ø§Ø·Ø¦Ø©!"); }
            };
            optsDiv.appendChild(b);
        });
    },

    genQ() {
        let a = Math.floor(Math.random()*12), b = Math.floor(Math.random()*12), ans, txt;
        if(this.difficulty === 'easy') { txt = `${toAr(a)} ï¼‹ ${toAr(b)}`; ans = a+b; }
        else if(this.difficulty === 'medium') { txt = `${toAr(a)} Ã— ${toAr(b)}`; ans = a*b; }
        else { ans = Math.floor(Math.random()*10); b = Math.floor(Math.random()*9)+1; a = ans*b; txt = `${toAr(a)} Ã· ${toAr(b)}`; }
        let opts = [ans, ans+1, ans+10, ans-2].filter(n=>n>=0).sort(()=>Math.random()-0.5);
        return { txt, ans, opts: [...new Set(opts)].slice(0,4) };
    },

    nextStage() {
        this.active = false; audio.playEffect(600, 'sine', 0.1); audio.playEffect(800, 'sine', 0.1);
        setTimeout(() => {
            alert(`Ù…Ø¨Ø±ÙˆÙƒ! ØªØ¬Ø§ÙˆØ²Øª Ø§Ù„Ù…Ø±Ø­Ù„Ø© ${toAr(this.stage)}`);
            this.stage++; this.dist = 0; this.fuel = 100; this.enemies = []; this.active = true; this.loop();
        }, 100);
    },

    end(msg) {
        this.active = false; audio.updateEngine(0);
        document.getElementById('question-box').style.display = 'none';
        document.getElementById('over-reason').innerText = msg;
        document.getElementById('game-over').style.display = 'flex';
    },

    loop() { if(this.active) { this.update(); this.draw(); requestAnimationFrame(() => this.loop()); } }
};

const input = { left: false, right: false, gas: false };
const setup = (id, key) => {
    const el = document.getElementById(id);
    el.onpointerdown = (e) => { e.preventDefault(); audio.init(); input[key] = true; };
    el.onpointerup = (e) => { e.preventDefault(); input[key] = false; };
};
setup('l-btn', 'left'); setup('r-btn', 'right'); setup('gas-btn', 'gas');
window.onkeydown = (e) => { audio.init(); if(e.key.includes('Left')) input.left = true; if(e.key.includes('Right')) input.right = true; if(e.key===' '||e.key.includes('Up')) input.gas = true; };
window.onkeyup = (e) => { if(e.key.includes('Left')) input.left = false; if(e.key.includes('Right')) input.right = false; if(e.key===' '||e.key.includes('Up')) input.gas = false; };
</script>
</body>
</html>
