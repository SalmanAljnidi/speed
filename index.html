<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Road Fighter - Salman Al-Junaidi</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@900&display=swap');
        
        body {
            margin: 0; background: #222; font-family: 'Cairo', sans-serif;
            color: white; overflow: hidden; display: flex; flex-direction: column; align-items: center;
        }

        #game-container {
            position: relative; width: 100vw; max-width: 450px; height: 82vh;
            border: 5px solid #444; background: #333; overflow: hidden;
            box-shadow: 0 0 50px rgba(0,0,0,0.8);
        }

        canvas { width: 100%; height: 100%; image-rendering: pixelated; }

        /* HUD */
        #hud {
            position: absolute; top: 0; left: 0; width: 100%; height: 60px;
            background: rgba(0,0,0,0.85); display: flex; justify-content: space-around;
            align-items: center; z-index: 50; border-bottom: 3px solid #f1c40f;
            font-size: 1.1rem; color: #fff;
        }

        .overlay {
            position: absolute; inset: 0; background: rgba(0,0,0,0.95);
            display: flex; flex-direction: column; justify-content: center; align-items: center; z-index: 100;
            text-align: center;
        }

        .game-title {
            color: #ff3d00; font-size: 3rem; text-shadow: 3px 3px #fff; margin-bottom: 10px;
        }

        .btn {
            background: #d32f2f; color: white; border: 3px solid #fff; padding: 15px 30px;
            margin: 10px; cursor: pointer; font-size: 1.3rem; font-weight: bold; border-radius: 12px;
            box-shadow: 0 5px 0 #5d0000; transition: 0.1s;
        }

        .btn:active { transform: translateY(4px); box-shadow: 0 1px 0 #5d0000; }

        #question-box {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            width: 85%; background: #fff; color: #111; border: 6px solid #1e88e5;
            padding: 25px; z-index: 200; display: none; flex-direction: column; border-radius: 25px;
        }

        .ans-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 20px; }
        .ans-btn { background: #1e88e5; color: white; border: none; padding: 18px; font-size: 1.6rem; border-radius: 12px; font-weight: 900; }

        #controls {
            display: flex; width: 100%; max-width: 450px; height: 13vh;
            background: #111; justify-content: space-around; align-items: center;
        }
        .ctrl-btn { width: 70px; height: 70px; background: #333; border: 2px solid #666; border-radius: 50%; display: flex; justify-content: center; align-items: center; font-size: 2rem; user-select: none; }
        #gas-btn { background: #2e7d32; width: 90px; height: 90px; border: 4px solid #fff; font-size: 1.2rem; font-weight: bold; }

        .rights { margin-top: 15px; font-size: 0.8rem; color: #aaa; }
        .social { display: flex; gap: 20px; margin-top: 10px; }
        .social img { width: 40px; cursor: pointer; }
    </style>
</head>
<body>

<div id="game-container">
    <div id="hud">
        <div id="hud-fuel">Ø§Ù„ÙˆÙ‚ÙˆØ¯: Ù¡Ù Ù Ùª</div>
        <div id="hud-speed">Ø§Ù„Ø³Ø±Ø¹Ø©: Ù </div>
        <div id="hud-stage">Ø§Ù„Ù…Ø±Ø­Ù„Ø©: Ù¡</div>
    </div>

    <canvas id="gameCanvas"></canvas>

    <div id="start-screen" class="overlay">
        <h1 class="game-title">ROAD FIGHTER</h1>
        <p style="font-size: 1.5rem;">Ø¨Ø¥Ø´Ø±Ø§Ù Ø³Ù„Ù…Ø§Ù† Ø§Ù„Ø¬Ù†ÙŠØ¯ÙŠ</p>
        <button class="btn" onclick="game.start('easy')">Ù…Ø¨ØªØ¯Ø¦ (ï¼‹/ï¼)</button>
        <button class="btn" onclick="game.start('medium')">Ù…ØªÙˆØ³Ø· (Ã—)</button>
        <button class="btn" onclick="game.start('hard')">Ù…Ø­ØªØ±Ù (Ã·/Ã—)</button>
        
        <div class="rights">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø© Ù„Ù€ Ø³Ù„Ù…Ø§Ù† Ø§Ù„Ø¬Ù†ÙŠØ¯ÙŠ</div>
        <div class="social">
            <a href="https://wa.me/966566996166" target="_blank">ğŸŸ¢ ÙˆØ§ØªØ³Ø§Ø¨</a>
            <a href="https://snapchat.com/t/2fysJJzn" target="_blank">ğŸŸ¡ Ø³Ù†Ø§Ø¨ Ø´Ø§Øª</a>
        </div>
    </div>

    <div id="question-box">
        <h2 id="q-text" style="text-align:center; font-size: 2.2rem; margin:0;">Ø§Ù„Ø³Ø¤Ø§Ù„</h2>
        <div id="options" class="ans-grid"></div>
    </div>

    <div id="game-over" class="overlay" style="display:none">
        <h1 id="over-reason" style="color:#ff5252; font-size: 2.5rem;">Ø§Ù†ØªÙ‡Øª Ø§Ù„Ù„Ø¹Ø¨Ø©</h1>
        <button class="btn" onclick="location.reload()">Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø©</button>
    </div>
</div>

<div id="controls">
    <div class="ctrl-btn" id="l-btn">â—€</div>
    <div class="ctrl-btn" id="gas-btn">Ø§Ø¯Ø¹Ø³ â›½</div>
    <div class="ctrl-btn" id="r-btn">â–¶</div>
</div>

<script>
const toAr = (n) => n.toString().replace(/\d/g, d => "Ù Ù¡Ù¢Ù£Ù¤Ù¥Ù¦Ù§Ù¨Ù©"[d]);

// Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„ØµÙˆØªÙŠ Arcade
const audio = {
    ctx: null,
    init() { if(!this.ctx) this.ctx = new (window.AudioContext || window.webkitAudioContext)(); },
    play(freq, type, dur, vol=0.1) {
        this.init();
        const osc = this.ctx.createOscillator();
        const g = this.ctx.createGain();
        osc.type = type;
        osc.frequency.setValueAtTime(freq, this.ctx.currentTime);
        g.gain.setValueAtTime(vol, this.ctx.currentTime);
        osc.connect(g); g.connect(this.ctx.destination);
        osc.start(); osc.stop(this.ctx.currentTime + dur);
    }
};

const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
canvas.width = 400; canvas.height = 600;

const game = {
    active: false, speed: 0, fuel: 100, stage: 1, dist: 0,
    playerX: 182, enemies: [], trees: [], roadY: 0, difficulty: 'easy',

    start(lvl) {
        this.difficulty = lvl; this.active = true;
        document.getElementById('start-screen').style.display = 'none';
        for(let i=0; i<8; i++) this.trees.push({x: i%2===0?20:350, y: i*120});
        this.loop();
    },

    // Ø±Ø³Ù… Ø³ÙŠØ§Ø±Ø© Ø§Ø­ØªØ±Ø§ÙÙŠØ© Ø­Ù‚ÙŠÙ‚ÙŠØ©
    drawCar(x, y, color, isPlayer) {
        ctx.save();
        ctx.translate(x, y);
        // Ø¬Ø³Ù… Ø§Ù„Ø³ÙŠØ§Ø±Ø©
        ctx.fillStyle = color;
        ctx.beginPath();
        ctx.roundRect(0, 0, 38, 65, 10);
        ctx.fill();
        // Ø§Ù„Ø²Ø¬Ø§Ø¬ Ø§Ù„Ù…Ø¸Ù„Ù„
        ctx.fillStyle = '#1a1a1a';
        ctx.fillRect(5, 12, 28, 15); // Ø§Ù„Ø£Ù…Ø§Ù…ÙŠ
        ctx.fillRect(5, 45, 28, 8);  // Ø§Ù„Ø®Ù„ÙÙŠ
        // Ø¥Ø·Ø§Ø±Ø§Øª
        ctx.fillStyle = '#000';
        ctx.fillRect(-3, 8, 5, 15); ctx.fillRect(36, 8, 5, 15);
        ctx.fillRect(-3, 40, 5, 15); ctx.fillRect(36, 40, 5, 15);
        // Ø§Ù„Ù…ØµØ§Ø¨ÙŠØ­
        ctx.fillStyle = isPlayer ? '#fff' : '#ff5252';
        ctx.fillRect(5, 2, 8, 4); ctx.fillRect(25, 2, 8, 4);
        // ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø³Ø¨Ø§Ù‚
        ctx.strokeStyle = 'rgba(255,255,255,0.4)';
        ctx.lineWidth = 2;
        ctx.strokeRect(4, 4, 30, 57);
        ctx.restore();
    },

    drawTree(x, y) {
        ctx.fillStyle = '#4e342e'; ctx.fillRect(x+12, y+35, 8, 15); // Ø¬Ø°Ø¹
        ctx.fillStyle = '#1b5e20'; // Ø£ÙˆØ±Ø§Ù‚
        ctx.beginPath(); ctx.moveTo(x+16, y); ctx.lineTo(x+35, y+40); ctx.lineTo(x-3, y+40); ctx.fill();
    },

    update() {
        if (!this.active) return;

        if (input.gas) {
            this.speed = Math.min(this.speed + 0.15, 9 + this.stage);
            this.fuel -= 0.05;
            this.dist += this.speed;
            if(Math.random() > 0.9) audio.play(100 + this.speed*15, 'sawtooth', 0.05, 0.05);
        } else {
            this.speed = Math.max(this.speed - 0.1, 0);
        }

        if (this.fuel <= 0) this.end("Ø§Ù†ØªÙ‡Ù‰ Ø§Ù„ÙˆÙ‚ÙˆØ¯ ÙŠØ§ Ø¨Ø·Ù„!");

        this.roadY += this.speed;
        if (input.left && this.playerX > 65) this.playerX -= 6;
        if (input.right && this.playerX < 300) this.playerX += 6;

        // Ø§Ù„Ø£Ø´Ø¬Ø§Ø± ØªØªØ­Ø±Ùƒ Ø¨Ø¬Ø¯ÙŠØ©
        this.trees.forEach(t => {
            t.y += this.speed;
            if (t.y > canvas.height) t.y = -100;
        });

        // Ø§Ù„Ø£Ø¹Ø¯Ø§Ø¡ (ÙŠØªÙˆÙ‚ÙÙˆÙ† Ø¹Ù†Ø¯ ÙˆÙ‚ÙˆÙÙƒ)
        if (this.speed > 0 && this.enemies.length < 3 && Math.random() < 0.03) {
            let lx = [80, 150, 220, 290][Math.floor(Math.random()*4)];
            if(!this.enemies.some(e => e.y < 150 && e.x === lx)) {
                this.enemies.push({x: lx, y: -100, s: 1 + Math.random()});
            }
        }

        this.enemies.forEach((en, i) => {
            en.y += (this.speed * 0.6) + en.s; 
            if (this.playerX < en.x + 38 && this.playerX + 38 > en.x && 500 < en.y + 65 && 565 > en.y) {
                this.ask();
            }
            if (en.y > canvas.height) this.enemies.splice(i, 1);
        });

        if (this.dist > 4000) this.nextStage();

        document.getElementById('hud-fuel').innerText = `Ø§Ù„ÙˆÙ‚ÙˆØ¯: ${toAr(Math.ceil(this.fuel))}Ùª`;
        document.getElementById('hud-speed').innerText = `Ø§Ù„Ø³Ø±Ø¹Ø©: ${toAr(Math.floor(this.speed * 38))} ÙƒÙ…/Ø³`;
        document.getElementById('hud-stage').innerText = `Ø§Ù„Ù…Ø±Ø­Ù„Ø©: ${toAr(this.stage)}`;
    },

    draw() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        
        // Ø§Ù„Ø¨ÙŠØ¦Ø©
        ctx.fillStyle = '#2e7d32'; ctx.fillRect(0,0, canvas.width, canvas.height); // Ø¹Ø´Ø¨
        ctx.fillStyle = '#444'; ctx.fillRect(60, 0, 280, canvas.height); // Ø·Ø±ÙŠÙ‚
        
        // Ø£Ø±ØµÙØ© Ø§Ù„Ø·Ø±ÙŠÙ‚ (ÙƒØ±Ù†ÙŠØ´)
        for(let i=-1; i<16; i++) {
            let y = (i*40) + (this.roadY % 40);
            ctx.fillStyle = (Math.floor(this.roadY/40)+i)%2===0 ? '#fff' : '#d32f2f';
            ctx.fillRect(60, y, 8, 40);
            ctx.fillRect(332, y, 8, 40);
        }

        // Ø®Ø·ÙˆØ· Ø§Ù„Ù…Ø³Ø§Ø±Ø§Øª
        ctx.strokeStyle = 'rgba(255,255,255,0.4)'; ctx.setLineDash([25, 35]);
        ctx.lineDashOffset = -this.roadY;
        [130, 200, 270].forEach(lx => {
            ctx.beginPath(); ctx.moveTo(lx, 0); ctx.lineTo(lx, canvas.height); ctx.stroke();
        });

        this.trees.forEach(t => this.drawTree(t.x, t.y));

        // Ø®Ø· Ø§Ù„Ù†Ù‡Ø§ÙŠØ©
        if (this.dist > 3500) {
            let ly = 500 - (this.dist - 3500);
            ctx.fillStyle = '#fff';
            for(let i=0; i<7; i++) ctx.fillRect(68 + i*40, ly, 20, 20);
        }

        this.drawCar(this.playerX, 500, '#d32f2f', true);
        this.enemies.forEach(en => this.drawCar(en.x, en.y, '#ffc107', false));
    },

    ask() {
        this.active = false; audio.play(200, 'square', 0.3);
        const qData = this.genQ();
        const box = document.getElementById('question-box');
        box.style.display = 'flex';
        document.getElementById('q-text').innerText = qData.txt;
        const optsDiv = document.getElementById('options');
        optsDiv.innerHTML = '';
        
        qData.opts.forEach(o => {
            const b = document.createElement('button');
            b.className = 'ans-btn'; b.innerText = toAr(o);
            b.onclick = () => {
                if (o === qData.ans) {
                    audio.play(800, 'sine', 0.2);
                    box.style.display = 'none';
                    this.fuel = 100; this.enemies = []; this.active = true; this.loop();
                } else { this.end("Ø¥Ø¬Ø§Ø¨Ø© Ø®Ø§Ø·Ø¦Ø©! Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰."); }
            };
            optsDiv.appendChild(b);
        });
    },

    genQ() {
        let a, b, ans, txt;
        const lvl = this.difficulty;
        if (lvl === 'easy') {
            a = Math.floor(Math.random()*11); b = Math.floor(Math.random()*11);
            if (Math.random()>0.5) { txt = `${toAr(a)} ï¼‹ ${toAr(b)}`; ans = a+b; }
            else { txt = `${toAr(Math.max(a,b))} ï¼ ${toAr(Math.min(a,b))}`; ans = Math.max(a,b)-Math.min(a,b); }
        } else if (lvl === 'medium') {
            a = Math.floor(Math.random()*11); b = Math.floor(Math.random()*11);
            txt = `${toAr(a)} Ã— ${toAr(b)}`; ans = a*b;
        } else {
            if(Math.random()>0.5) {
                a = Math.floor(Math.random()*13); b = Math.floor(Math.random()*13);
                txt = `${toAr(a)} Ã— ${toAr(b)}`; ans = a*b;
            } else {
                ans = Math.floor(Math.random()*10); b = Math.floor(Math.random()*9)+1;
                a = ans * b; txt = `${toAr(a)} Ã· ${toAr(b)}`;
            }
        }
        let opts = [ans, ans+1, ans+5, ans-2].filter(n => n >= 0).sort(() => Math.random()-0.5);
        return { txt, ans, opts: [...new Set(opts)].slice(0,4) };
    },

    nextStage() {
        this.active = false; audio.play(1000, 'sine', 0.5);
        alert(`ÙƒÙÙˆ ÙŠØ§ Ø¨Ø·Ù„! Ø§Ù†ØªÙ‚Ù„Øª Ù„Ù„Ù…Ø±Ø­Ù„Ø© ${toAr(++this.stage)}`);
        this.dist = 0; this.fuel = 100; this.enemies = []; this.active = true; this.loop();
    },

    end(msg) {
        this.active = false;
        document.getElementById('question-box').style.display = 'none';
        document.getElementById('over-reason').innerText = msg;
        document.getElementById('game-over').style.display = 'flex';
    },

    loop() {
        if (!this.active) return;
        this.update(); this.draw();
        requestAnimationFrame(() => this.loop());
    }
};

const input = { left: false, right: false, gas: false };
window.onkeydown = (e) => {
    audio.init();
    if (e.key === 'ArrowLeft') input.left = true;
    if (e.key === 'ArrowRight') input.right = true;
    if (e.key === 'ArrowUp' || e.key === ' ') input.gas = true;
};
window.onkeyup = (e) => {
    if (e.key === 'ArrowLeft') input.left = false;
    if (e.key === 'ArrowRight') input.right = false;
    if (e.key === 'ArrowUp' || e.key === ' ') input.gas = false;
};
const setup = (id, key) => {
    const el = document.getElementById(id);
    el.onpointerdown = (e) => { e.preventDefault(); audio.init(); input[key] = true; };
    el.onpointerup = (e) => { e.preventDefault(); input[key] = false; };
};
setup('l-btn', 'left'); setup('r-btn', 'right'); setup('gas-btn', 'gas');
</script>
</body>
</html>
